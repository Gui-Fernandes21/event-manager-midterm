<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<link rel="stylesheet" type="text/css" href="/main.css" />
		<title>Organizer Dashboard - <%= siteInfo.name %></title>
	</head>
	<body>
		<div class="container">
			<header class="header">
				<div class="header-content">
					<h1>Organizer Home Page</h1>
					<div class="site-info">
						<h2 class="site-name"><%= siteInfo.name %></h2>
						<p class="site-description"><%= siteInfo.description %></p>
					</div>
				</div>
				<div class="header-actions">
					<a href="/" class="btn btn-primary">Home Page</a>
					<div class="auth">
						<% if (typeof user !== 'undefined' && user) { %>
						<div class="nav-user-info">
							Welcome, <span class="nav-user-name"><%= user.user_name %></span>
						</div>
						<a href="/auth/logout" class="btn btn-logout">Logout</a>
						<% } %>
					</div>
					<div class="actions">
						<a href="/organizer/settings" class="btn btn-secondary"
							>Site Settings</a
						>
						<a href="/organizer/create-event" class="btn btn-primary">
							Create New Event
						</a>
					</div>
				</div>
			</header>

			<!-- Published Events Section -->
			<section class="events-section">
				<h2 class="section-title">Published Events</h2>
				<% if (publishedEvents && publishedEvents.length > 0) { %>
				<div class="events-grid">
					<% publishedEvents.forEach(function(event) { %>
					<div class="event-card published">
						<div class="event-card-header">
							<h3 class="event-title"><%= event.title %></h3>
							<span class="event-status status-published">Published</span>
						</div>
						<div class="event-card-body">
							<p class="event-description">
								<%= event.description || 'No description' %>
							</p>
							<div class="event-meta">
								<div class="event-date">
									<strong>Date:</strong> <%= new
									Date(event.date).toLocaleDateString() %> at <%= new
									Date(event.date).toLocaleTimeString([], {hour: '2-digit',
									minute:'2-digit'}) %>
								</div>
								<div class="event-created">
									<strong>Created:</strong> <%= new
									Date(event.createdAt).toLocaleDateString() %>
								</div>
								<div class="event-published">
									<strong>Published:</strong> <%= new
									Date(event.publishedAt).toLocaleDateString() %>
								</div>
								<div class="ticket-info">
									<span class="ticket-count"
										>General: <%= event.tickets_general %></span
									>
									<span class="ticket-count"
										>VIP: <%= event.tickets_vip %></span
									>
								</div>
							</div>
						</div>
						<div class="event-card-footer">
							<button
								class="btn btn-info btn-sm sharing-link-btn"
								data-event-id="<%= event.event_id %>"
							>
								Get Sharing Link
							</button>
							<form
								class="event-action-form"
								action="/organizer/delete-event/<%= event.event_id %>"
								method="post"
								style="display: inline"
								onsubmit="return confirm('Are you sure you want to delete this event?')"
							>
								<button type="submit" class="btn btn-danger btn-sm">
									Delete
								</button>
							</form>
						</div>
					</div>
					<% }); %>
				</div>
				<% } else { %>
				<div class="no-events">
					<p>No published events yet. Create and publish your first event!</p>
				</div>
				<% } %>
			</section>

			<!-- Draft Events Section -->
			<section class="events-section">
				<h2 class="section-title">Draft Events</h2>
				<% if (draftEvents && draftEvents.length > 0) { %>
				<div class="events-grid">
					<% draftEvents.forEach(function(event) { %>
					<div class="event-card draft">
						<div class="event-card-header">
							<h3 class="event-title"><%= event.title %></h3>
							<span class="event-status status-draft">Draft</span>
						</div>
						<div class="event-card-body">
							<p class="event-description">
								<%= event.description || 'No description' %>
							</p>
							<div class="event-meta">
								<div class="event-date">
									<strong>Date:</strong> <%= new
									Date(event.date).toLocaleDateString() %> at <%= new
									Date(event.date).toLocaleTimeString([], {hour: '2-digit',
									minute:'2-digit'}) %>
								</div>
								<div class="event-created">
									<strong>Created:</strong> <%= new
									Date(event.createdAt).toLocaleDateString() %>
								</div>
								<div class="ticket-info">
									<span class="ticket-count"
										>General: <%= event.tickets_general %></span
									>
									<span class="ticket-count"
										>VIP: <%= event.tickets_vip %></span
									>
								</div>
							</div>
						</div>
						<div class="event-card-footer">
							<a
								href="/organizer/edit-event/<%= event.event_id %>"
								class="btn btn-secondary btn-sm"
								>Edit</a
							>
							<form
								action="/organizer/publish-event/<%= event.event_id %>"
								method="post"
								class="event-action-form"
								style="display: inline"
							>
								<button type="submit" class="btn btn-success btn-sm">
									Publish
								</button>
							</form>
							<form
								action="/organizer/delete-event/<%= event.event_id %>"
								method="post"
								class="event-action-form"
								style="display: inline"
								onsubmit="return confirm('Are you sure you want to delete this draft?')"
							>
								<button type="submit" class="btn btn-danger btn-sm">
									Delete
								</button>
							</form>
						</div>
					</div>
					<% }); %>
				</div>
				<% } else { %>
				<div class="no-events">
					<p>No draft events. Click "Create New Event" to get started!</p>
				</div>
				<% } %>
			</section>
		</div>

		<!-- Sharing Link Modal -->
		<div id="sharingModal" class="modal">
			<div class="modal-content">
				<span class="close">&times;</span>
				<h3>Event Sharing Link</h3>
				<div id="sharingLinkContent">
					<p>Share this link with attendees:</p>
					<input type="text" id="sharingLinkInput" readonly />
					<button class="btn btn-primary" onclick="copyToClipboard()">
						Copy Link
					</button>
				</div>
			</div>
		</div>

		<script>
			// Sharing link functionality
			document.querySelectorAll(".sharing-link-btn").forEach((button) => {
				button.addEventListener("click", function () {
					const eventId = this.getAttribute("data-event-id");
					fetch(`/organizer/sharing-link/${eventId}`)
						.then((response) => response.json())
						.then((data) => {
							document.getElementById("sharingLinkInput").value =
								data.sharingLink;
							document.getElementById("sharingModal").style.display = "block";
						})
						.catch((error) => {
							alert("Error getting sharing link: " + error.message);
						});
				});
			});

			// Modal functionality
			document.querySelector(".close").addEventListener("click", function () {
				document.getElementById("sharingModal").style.display = "none";
			});

			window.addEventListener("click", function (event) {
				const modal = document.getElementById("sharingModal");
				if (event.target === modal) {
					modal.style.display = "none";
				}
			});

			// Copy to clipboard functionality
			function copyToClipboard() {
				const input = document.getElementById("sharingLinkInput");
				input.select();
				document.execCommand("copy");
				alert("Link copied to clipboard!");
			}
		</script>
	</body>
</html>
